<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Open-Meteo">Open-Meteo</h2><h3 id="简介">简介</h3><p>Open-Meteo 是一个开源天气 API，可供非商业用途免费使用。无需 API 密钥。其中包含很多预测模型的数据。</p><h3 id="使用方式">使用方式</h3><p>可以编写如下 <code>docker-compose.yaml</code> 使用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">open-meteo:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/open-meteo/open-meteo</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./data:/app/data&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;8080:8080&#x27;</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;serve&quot;</span>, <span class="hljs-string">&quot;--env&quot;</span>, <span class="hljs-string">&quot;production&quot;</span>, <span class="hljs-string">&quot;--hostname&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-string">&quot;--port&quot;</span>, <span class="hljs-string">&quot;8080&quot;</span>]<br></code></pre></td></tr></table></figure><h3 id="数据同步">数据同步</h3><p>使用 <code>openmeteo-api sync</code> 命令可以从 AWS S3 上下载最新的数据集到本地，此处可以自己构建一个镜像利用 cron 命令实现定时拉取数据。</p><p>编写 <code>sync-cron</code> ：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">* * * * * /usr/local/bin/openmeteo-api sync ecmwf_ifs04 temperature_2m &gt;&gt; /var/log/cron.log 2&gt;&amp;1<br><br></code></pre></td></tr></table></figure><p>编写 <code>Dockerfile</code> ：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs text">FROM ubuntu:jammy<br><br>RUN apt-get update &amp;&amp; apt-get -y install cron gpg curl<br><br>RUN curl -L https://apt.open-meteo.com/public.key | gpg --dearmour -o /etc/apt/trusted.gpg.d/openmeteo.gpg<br><br>RUN echo &quot;deb [arch=amd64] https://apt.open-meteo.com jammy main&quot; | tee /etc/apt/sources.list.d/openmeteo-api.list<br><br>RUN apt-get update<br><br>RUN apt-get install openmeteo-api -y<br><br>COPY sync-cron /etc/cron.d/sync-cron<br><br>RUN chmod 0644 /etc/cron.d/sync-cron<br><br>RUN crontab /etc/cron.d/sync-cron<br><br>RUN touch /var/log/cron.log<br><br>CMD cron &amp;&amp; tail -f /var/log/cron.log<br></code></pre></td></tr></table></figure><p>之后编写 <code>docker-compose.yaml</code> ：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">open-meteo:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/open-meteo/open-meteo</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./data:/app/data&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;8080:8080&#x27;</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;serve&quot;</span>, <span class="hljs-string">&quot;--env&quot;</span>, <span class="hljs-string">&quot;production&quot;</span>, <span class="hljs-string">&quot;--hostname&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-string">&quot;--port&quot;</span>, <span class="hljs-string">&quot;8080&quot;</span>]<br>  <span class="hljs-attr">sync:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">cron-meteo:latest</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;./data:/var/lib/openmeteo-api/data&quot;</span><br></code></pre></td></tr></table></figure><p>使用如下命令构建容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose build --no-cache<br></code></pre></td></tr></table></figure><p>使用如下命令运行容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><h3 id="参考资料">参考资料</h3><p><a href="https://open-meteo.com/">官网</a></p><p><a href="https://github.com/open-meteo/open-meteo/blob/main/docs/getting-started.md">同步教程</a></p>