<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="OpenRewrite">OpenRewrite</h2><h3 id="简介">简介</h3><p>OpenRewrite 是一个用于源代码的自动重构生态系统，可以便捷的完成新版本的代码适配与迁移。</p><h3 id="使用方式">使用方式</h3><p>首先需要在 Gradle 的 build.gradle 文件中添加如下代码：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;org.openrewrite.rewrite&#x27;</span> version <span class="hljs-string">&#x27;6.10.0&#x27;</span><br>&#125;<br>rewrite &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>之后就可以通过 <code>./gradlew rewriteDiscover </code> 命令来查看 OpenRewrite 中的规则。</p><p>例如可以编辑如下所示的 <a href="https://docs.openrewrite.org/recipes/java/spring/boot3/springbootproperties_3_2">规则</a> ，升级 Spring Boot 到 3.2 版本：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs groovy">plugins &#123;<br>    id <span class="hljs-string">&#x27;java&#x27;</span><br>    id <span class="hljs-string">&#x27;org.openrewrite.rewrite&#x27;</span> version <span class="hljs-string">&#x27;6.10.0&#x27;</span><br>    id <span class="hljs-string">&#x27;org.springframework.boot&#x27;</span> version <span class="hljs-string">&#x27;3.1.10-SNAPSHOT&#x27;</span><br>    id <span class="hljs-string">&#x27;io.spring.dependency-management&#x27;</span> version <span class="hljs-string">&#x27;1.1.4&#x27;</span><br>&#125;<br><br>java &#123;<br>    sourceCompatibility = <span class="hljs-string">&#x27;17&#x27;</span><br>&#125;<br><br>rewrite &#123;<br>    activeRecipe(<span class="hljs-string">&quot;org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_2&quot;</span>)<br>&#125;<br><br>configurations &#123;<br>    compileOnly &#123;<br>        extendsFrom annotationProcessor<br>    &#125;<br>&#125;<br><br>repositories &#123;<br>    mavenCentral()<br>    maven &#123; url <span class="hljs-string">&#x27;https://repo.spring.io/milestone&#x27;</span> &#125;<br>    maven &#123; url <span class="hljs-string">&#x27;https://repo.spring.io/snapshot&#x27;</span> &#125;<br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-starter-web&#x27;</span><br>    compileOnly <span class="hljs-string">&#x27;org.projectlombok:lombok&#x27;</span><br>    developmentOnly <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-devtools&#x27;</span><br>    annotationProcessor <span class="hljs-string">&#x27;org.projectlombok:lombok&#x27;</span><br>    testImplementation <span class="hljs-string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span><br>    rewrite(<span class="hljs-string">&quot;org.openrewrite.recipe:rewrite-spring:5.6.0&quot;</span>)<br>&#125;<br><br>tasks.named(<span class="hljs-string">&#x27;bootBuildImage&#x27;</span>) &#123;<br>    builder = <span class="hljs-string">&#x27;paketobuildpacks/builder-jammy-base:latest&#x27;</span><br>&#125;<br><br>tasks.named(<span class="hljs-string">&#x27;test&#x27;</span>) &#123;<br>    useJUnitPlatform()<br>&#125;<br></code></pre></td></tr></table></figure><p>之后即可使用 <code>./gradlew rewriteRun</code> 命令来运行 OpenRewrite。</p><p>除此之外还有很多的 OpenRewrite 的规则，可以参考 <a href="https://docs.openrewrite.org/recipes">规则官方页面</a>。</p><h3 id="参考资料">参考资料</h3><p><a href="https://docs.openrewrite.org/">官方网站</a></p><p><a href="https://www.youtube.com/watch?v=e4R6AZHpAD8">Upgrading your Java &amp; Spring Boot applications with OpenRewrite in IntelliJ</a></p><p><a href="https://github.com/danvega/rewrite">Upgrading your Java &amp; Spring Applications with OpenRewrite</a></p>