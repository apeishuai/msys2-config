<p data-pid="TuYnYC6G">在前面的基础上：</p><a href="https://zhuanlan.zhihu.com/p/599518429" data-draft-node="block" data-draft-type="link-card" class="internal">迦非喵：CMake+VS2022+hdf5-1.14.0编译运行hdf5示例代码h5ex_t_int.c</a><p data-pid="EC7D0x7h">这里继续重构：</p><p data-pid="B4wJ1zqW">CMakeLists.txt</p><div class="highlight"><pre><code class="language-cmake"><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span> <span class="s">3.24</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">project</span> <span class="p">(</span> <span class="s">testprj</span> <span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">set</span> <span class="p">(</span> <span class="s">PRJ_COMPILE_FEATURES</span> <span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">set</span> <span class="p">(</span> <span class="s">PRJ_LIBRARIES</span> <span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">set</span> <span class="p">(</span> <span class="s">PRJ_INCLUDE_DIRS</span> <span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">list</span> <span class="p">(</span> <span class="s">APPEND</span> <span class="s">PRJ_COMPILE_FEATURES</span> <span class="s">cxx_std_20</span> <span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">find_package</span><span class="p">(</span><span class="s">HDF5</span> <span class="s">REQUIRED</span><span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">if</span> <span class="p">(</span> <span class="s">HDF5_FOUND</span> <span class="p">)</span><span class="err">
</span><span class="err"></span>    <span class="nb">list</span> <span class="p">(</span> <span class="s">APPEND</span> <span class="s">PRJ_LIBRARIES</span> <span class="o">${</span><span class="nv">HDF5_LIBRARIES</span><span class="o">}</span> <span class="p">)</span><span class="err">
</span><span class="err"></span>    <span class="nb">list</span> <span class="p">(</span> <span class="s">APPEND</span> <span class="s">PRJ_INCLUDE_DIRS</span> <span class="o">${</span><span class="nv">HDF5_INCLUDE_DIRS</span><span class="o">}</span> <span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">endif</span> <span class="p">()</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">message</span> <span class="p">(</span> <span class="s">STATUS</span> <span class="s2">"HDF5_INCLUDE_DIRS = ${HDF5_INCLUDE_DIRS}"</span> <span class="p">)</span><span class="err">
</span><span class="err"></span><span class="nb">message</span> <span class="p">(</span> <span class="s">STATUS</span> <span class="s2">"HDF5_LIBRARIES = ${HDF5_LIBRARIES}"</span> <span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">add_executable</span><span class="p">(</span> <span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span> 
    <span class="s">main.cpp</span>
<span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">target_include_directories</span> <span class="p">(</span> <span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
    <span class="s">PRIVATE</span> 
        <span class="o">${</span><span class="nv">PRJ_INCLUDE_DIRS</span><span class="o">}</span>
<span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">target_link_libraries</span><span class="p">(</span> <span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span> 
    <span class="s">PRIVATE</span> 
        <span class="o">${</span><span class="nv">PRJ_LIBRARIES</span><span class="o">}</span>
<span class="p">)</span><span class="err">
</span><span class="err">
</span><span class="err"></span><span class="nb">target_compile_features</span> <span class="p">(</span> <span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span> 
<span class="s">PRIVATE</span> 
<span class="o">${</span><span class="nv">PRJ_COMPILE_FEATURES</span><span class="o">}</span>
<span class="p">)</span><span class="err">
</span></code></pre></div><p data-pid="yGLB_H8P">main.cpp</p><div class="highlight"><pre><code class="language-cpp"><span class="cp">#include</span> <span class="cpf">"hdf5.h"</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="n">majnum</span><span class="p">,</span> <span class="n">minnum</span><span class="p">,</span> <span class="n">relnum</span><span class="p">;</span>
    <span class="n">H5get_libversion</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">majnum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minnum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">relnum</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"majnum = "</span> <span class="o">&lt;&lt;</span> <span class="n">majnum</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"minnum = "</span> <span class="o">&lt;&lt;</span> <span class="n">minnum</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"relnum = "</span> <span class="o">&lt;&lt;</span> <span class="n">relnum</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p data-pid="hz--blcd">windows11+powershell</p><p data-pid="PP6Tyq7j">cd d:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build\</p><p data-pid="N8jF3nB9">有</p><div class="highlight"><pre><code class="language-text">PS C:\Users\eric&gt; cd d:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build\</code></pre></div><p data-pid="mnkbyDdd">键入：</p><div class="highlight"><pre><code class="language-text">$env:HDF5_DIR = "c:/dev/HDF_Group/HDF5/1.10.9/cmake/"
$env:path += ";C:/dev/HDF_Group/HDF5/1.10.9/bin/"</code></pre></div><p data-pid="33AqG2rf">有：</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; $env:HDF5_DIR = "c:/dev/HDF_Group/HDF5/1.10.9/cmake/"
PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; $env:path += ";C:/dev/HDF_Group/HDF5/1.10.9/bin/"</code></pre></div><p data-pid="0K-78zk0">cmake ..</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; cmake ..
-- Building for: Visual Studio 17 2022
-- Selecting Windows SDK version 10.0.19041.0 to target Windows 10.0.22621.
-- The C compiler identification is MSVC 19.33.31630.0
-- The CXX compiler identification is MSVC 19.33.31630.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.33.31629/bin/Hostx64/x64/cl.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.33.31629/bin/Hostx64/x64/cl.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Found HDF5: hdf5::hdf5-shared (found version "1.10.9")
-- HDF5_INCLUDE_DIRS = C:/dev/HDF_Group/HDF5/1.10.9/include
-- HDF5_LIBRARIES = hdf5::hdf5-shared
-- Configuring done
-- Generating done
-- Build files have been written to: D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/build</code></pre></div><p data-pid="3wo6X9Az">cmake --build .</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; cmake --build .
MSBuild version 17.3.1+2badb37d1 for .NET Framework
  Checking Build System
  Building Custom Rule D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/CMakeLists.txt
  main.cpp
  testprj.vcxproj -&gt; D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build\Debug\testprj.exe
  Building Custom Rule D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/CMakeLists.txt</code></pre></div><p data-pid="UshezddF">.\Debug\testprj.exe</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; .\Debug\testprj.exe
majnum = 1
minnum = 10
relnum = 9</code></pre></div><p data-pid="KLMPQ9dx">如果重启powershell界面，删除D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build中内容重新构建有：</p><p data-pid="J_98xZaF">键入</p><div class="highlight"><pre><code class="language-text">$env:HDF5_DIR = "c:/dev/HDF_Group/HDF5/1.14.0/cmake/"
$env:path += ";C:/dev/HDF_Group/HDF5/1.14.0/bin/"</code></pre></div><p data-pid="7SVKypy5">有：</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; $env:HDF5_DIR = "c:/dev/HDF_Group/HDF5/1.14.0/cmake/"
PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; $env:path += ";C:/dev/HDF_Group/HDF5/1.14.0/bin/"</code></pre></div><p data-pid="ieM7QT-c">cmake ..</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; cmake ..
-- Building for: Visual Studio 17 2022
-- Selecting Windows SDK version 10.0.19041.0 to target Windows 10.0.22621.
-- The C compiler identification is MSVC 19.33.31630.0
-- The CXX compiler identification is MSVC 19.33.31630.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.33.31629/bin/Hostx64/x64/cl.exe - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.33.31629/bin/Hostx64/x64/cl.exe - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Found HDF5: hdf5::hdf5-shared (found version "1.14.0")
-- HDF5_INCLUDE_DIRS = C:/dev/HDF_Group/HDF5/1.14.0/include
-- HDF5_LIBRARIES = hdf5::hdf5-shared
-- Configuring done
-- Generating done
-- Build files have been written to: D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/build</code></pre></div><p data-pid="47fZJlNE">cmake --build .</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; cmake --build .
MSBuild version 17.3.1+2badb37d1 for .NET Framework
  Checking Build System
  Building Custom Rule D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/CMakeLists.txt
  main.cpp
  testprj.vcxproj -&gt; D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build\Debug\testprj.exe
  Building Custom Rule D:/work/hdf5_work/ModernHDF5/codes/H5get_libversion/02/CMakeLists.txt</code></pre></div><p data-pid="cMxEimEJ"> .\Debug\testprj.exe</p><div class="highlight"><pre><code class="language-text">PS D:\work\hdf5_work\ModernHDF5\codes\H5get_libversion\02\build&gt; .\Debug\testprj.exe
majnum = 1
minnum = 14
relnum = 0</code></pre></div><p data-pid="mJdwSHC1">对应有：</p><figure data-size="normal"><img src="https://pic4.zhimg.com/v2-9bfb27646f0c7e51460fe6ec7fbdf69b_1440w.jpg" data-caption="" data-size="normal" data-rawwidth="252" data-rawheight="109" class="content_image" referrerpolicy="no-referrer"></figure><p data-pid="rsc1yBmW">代码上传至：</p><a href="https://github.com/eric2003/ModernHDF5/tree/main/codes/H5get_libversion/02" data-draft-node="block" data-draft-type="link-card" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/eric2003/Mod</span><span class="invisible">ernHDF5/tree/main/codes/H5get_libversion/02</span><span class="ellipsis"></span></a><p data-pid="E-zp_k1D">为便于检索，文章收录于：</p><a href="https://zhuanlan.zhihu.com/p/452874893" data-draft-node="block" data-draft-type="link-card" class="internal">迦非喵：CGNS和hdf5编译链接相关文章链接整理（不定期更新）</a><p></p>