<p>写代码时， 一般我们有两种多标签使用场景：</p>
<ol>
  <li>快速重命名： 一般都是重命名光标下的 <strong>相同符号</strong> , 这方面 <a href="https://github.com/wolray/symbol-overlay">symbol-overlay</a> 做的最简单易用</li>
  <li>数据清洗： 快速把不同名字的符号进行格式化清洗， 从一种格式转换成另外一种格式， 这方面 <a href="https://github.com/meow-edit/meow">Meow</a> 的键盘宏做的最好用</li>
</ol>

<p>但是我平常写代码的时间远远多于看代码的时间， 非常不习惯任何模式转换插件， 所以我下午研究了一下 Meow 的键盘宏原理， 重写了一个新的插件 <a href="https://github.com/manateelazycat/markmacro">markmacro</a></p>

<p>markmacro 的原理和 Meow 键盘宏的理念一样：</p>
<ol>
  <li>用 overlay 快速标记一系列对象， 并自动启动键盘宏记录</li>
  <li>对最后一个对象进行任意操作</li>
  <li>最后操作一下， 把一个对象上的所有键盘宏扩展到所有标记的对象</li>
</ol>

<p>通过上面三个步骤， 我们灵活结合 Emacs 其他插件的能力， 快速清洗数据成我们期望的格式， 提升我们日常的编程效率。</p>

<p>为了直观的让大家理解这个插件的作用， 我编写了一些测试用例：</p>

<h3 id="case-1">Case 1</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_1.gif" alt="" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fruit</span> <span class="o">=</span> <span class="n">apple</span> <span class="n">watermelon</span> <span class="n">peaches</span>

<span class="o">=&gt;</span>

<span class="n">fruit</span> <span class="o">=</span> <span class="p">[</span><span class="s">"apple"</span><span class="p">,</span> <span class="s">"watermelon"</span><span class="p">,</span> <span class="s">"peaches"</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>select last three words</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-words</code> <strong>mark words</strong> in region and start kmacro record automatically</li>
  <li>Type <code class="language-plaintext highlighter-rouge">"</code> character, <code class="language-plaintext highlighter-rouge">forward-word</code>, type <code class="language-plaintext highlighter-rouge">"</code> character and <code class="language-plaintext highlighter-rouge">,</code> character</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark words</strong></li>
</ul>

<h3 id="case-2">Case 2</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_2.gif" alt="" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">it</span><span class="o">-</span><span class="ow">is</span><span class="o">-</span><span class="n">ver</span><span class="o">-</span><span class="nb">long</span><span class="o">-</span><span class="n">variable</span>

<span class="o">=&gt;</span>

<span class="n">it_is_ver_long_variable</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-words</code> <strong>mark words</strong> in symbol and start kmacro record automatically</li>
  <li>delete <code class="language-plaintext highlighter-rouge">-</code> and type ‘_’ character</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all-except-first</code> apply kmacro to all <strong>mark words</strong> except first word</li>
</ul>

<h3 id="case-3">Case 3</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_3.gif" alt="" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flex</span><span class="o">-</span><span class="n">auto</span>
<span class="n">flex</span><span class="o">-</span><span class="n">col</span>

<span class="n">flex</span><span class="o">-</span><span class="n">col</span><span class="o">-</span><span class="n">reverse</span>
<span class="n">flex</span><span class="o">-</span><span class="n">grow</span>
<span class="n">flex</span><span class="o">-</span><span class="n">initial</span>

<span class="n">flex</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">wrap</span>
<span class="n">flex</span><span class="o">-</span><span class="n">none</span>
<span class="n">flex</span><span class="o">-</span><span class="n">nowrap</span>
<span class="n">flex</span><span class="o">-</span><span class="n">row</span>

<span class="o">=&gt;</span>

<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">auto</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">col</span><span class="p">.</span><span class="n">txtt</span>

<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">col</span><span class="o">-</span><span class="n">reverse</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">grow</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">initial</span><span class="p">.</span><span class="n">txtt</span>

<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">wrap</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">none</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">nowrap</span><span class="p">.</span><span class="n">txtt</span>
<span class="n">prefix</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">row</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div></div>

<ul>
  <li>Select buffer</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-lines</code> <strong>mark lines</strong> in buffer and start kmacro record automatically</li>
  <li>Move to end of line, type <code class="language-plaintext highlighter-rouge">.txt</code> and move to beginning of line type <code class="language-plaintext highlighter-rouge">prefix-</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark lines</strong></li>
</ul>

<h3 id="case-4">Case 4</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_4.gif" alt="" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="s">"s-/"</span> <span class="o">.</span> <span class="nv">markmacro-mark-WORDS</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-?"</span> <span class="o">.</span> <span class="nv">markmacro-mark-LINES</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&lt;"</span> <span class="o">.</span> <span class="nv">markmacro-apply-ALL</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&gt;"</span> <span class="o">.</span> <span class="nv">markmacro-apply-FIRST</span><span class="p">)</span>

<span class="nv">=&gt;</span>

<span class="p">(</span><span class="s">"s-/"</span> <span class="o">.</span> <span class="nv">markmacro-words</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-?"</span> <span class="o">.</span> <span class="nv">markmacro-lines</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&lt;"</span> <span class="o">.</span> <span class="nv">markmacro-all</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&gt;"</span> <span class="o">.</span> <span class="nv">markmacro-first</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-mark-symbols</code> mark <strong>all symbols</strong> in rectangle area</li>
  <li>Move to end of line call <code class="language-plaintext highlighter-rouge">downcase-word</code>, and delete left word</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark symbols</strong></li>
</ul>

<h3 id="case-5">Case 5</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_5.gif" alt="" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="s">"s-/"</span> <span class="o">.</span> <span class="nv">markmacro-mark-words</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-?"</span> <span class="o">.</span> <span class="nv">markmacro-mark-lines</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&lt;"</span> <span class="o">.</span> <span class="nv">markmacro-apply-all</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-&gt;"</span> <span class="o">.</span> <span class="nv">markmacro-apply-all-except-first</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-M"</span> <span class="o">.</span> <span class="nv">markmacro-rect-set</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-D"</span> <span class="o">.</span> <span class="nv">markmacro-rect-delete</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-F"</span> <span class="o">.</span> <span class="nv">markmacro-rect-replace</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-I"</span> <span class="o">.</span> <span class="nv">markmacro-rect-insert</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-C"</span> <span class="o">.</span> <span class="nv">markmacro-rect-mark-columns</span><span class="p">)</span>
<span class="p">(</span><span class="s">"s-S"</span> <span class="o">.</span> <span class="nv">markmacro-rect-mark-symbols</span><span class="p">)</span>

<span class="nv">=&gt;</span>

<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-/"</span><span class="p">)</span> <span class="ss">'markmacro-mark-words</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-?"</span><span class="p">)</span> <span class="ss">'markmacro-mark-lines</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-&lt;"</span><span class="p">)</span> <span class="ss">'markmacro-apply-all</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-&gt;"</span><span class="p">)</span> <span class="ss">'markmacro-apply-all-except-first</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-M"</span><span class="p">)</span> <span class="ss">'markmacro-rect-set</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-D"</span><span class="p">)</span> <span class="ss">'markmacro-rect-delete</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-F"</span><span class="p">)</span> <span class="ss">'markmacro-rect-replace</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-I"</span><span class="p">)</span> <span class="ss">'markmacro-rect-insert</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-C"</span><span class="p">)</span> <span class="ss">'markmacro-rect-mark-columns</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">"s-S"</span><span class="p">)</span> <span class="ss">'markmacro-rect-mark-symbols</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-insert</code> insert <code class="language-plaintext highlighter-rouge">(global-set-key </code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line, <code class="language-plaintext highlighter-rouge">forward-char</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-replace</code> replace <code class="language-plaintext highlighter-rouge">(</code> with <code class="language-plaintext highlighter-rouge">(kbd </code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-insert</code> insert <code class="language-plaintext highlighter-rouge">)</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-delete</code> delete ` . `</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-set</code> record point at first line of rectangle, then move cursor to last line</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-rect-mark-columns</code> mark <strong>all columns</strong> in rectangle area</li>
  <li>Delete right character and type <code class="language-plaintext highlighter-rouge">'</code></li>
</ul>

<h3 id="case-6">Case 6</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_6.gif" alt="" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-1</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-2</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-3</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>

<span class="nv">=&gt;</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-1</span> <span class="p">(</span><span class="nv">new-arg</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-2</span> <span class="p">(</span><span class="nv">new-arg</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">test-function-3</span> <span class="p">(</span><span class="nv">new-arg</span> <span class="nv">arg</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-imenus</code> mark <strong>all functions</strong> and start kmacro record automatically</li>
  <li>isearch <code class="language-plaintext highlighter-rouge">(</code> character</li>
  <li>Type <code class="language-plaintext highlighter-rouge">new-arg</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark functions</strong></li>
</ul>

<h3 id="case-7">Case 7</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_7.gif" alt="" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">markmacro-mark-words</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">bound</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nv">region-end</span><span class="p">))</span>
                 <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">'symbol</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">mark-bounds</span> <span class="o">'</span><span class="p">()))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">bound</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">deactivate-mark</span><span class="p">))</span>

      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">mark-bound-start</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">bound</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">mark-bound-end</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">bound</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">last-point</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nv">current-bound</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">save-excursion</span>
          <span class="p">(</span><span class="nv">goto-char</span> <span class="nv">mark-bound-start</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="nv">mark-bound-end</span><span class="p">)</span>
                      <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="nv">last-point</span><span class="p">))</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">current-bound</span> <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">'word</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="nv">current-bound</span>
              <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mark-bounds</span> <span class="nv">current-bound</span> <span class="no">t</span><span class="p">))</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">last-point</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">forward-word</span><span class="p">))))</span>

      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">bound</span> <span class="nv">mark-bounds</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">overlay</span> <span class="p">(</span><span class="nv">make-overlay</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">bound</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">bound</span><span class="p">))))</span>
          <span class="p">(</span><span class="nv">overlay-put</span> <span class="nv">overlay</span> <span class="ss">'face</span> <span class="ss">'markmacro-mark-face</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'markmacro-overlays</span> <span class="nv">overlay</span> <span class="no">t</span><span class="p">)))</span>

      <span class="p">(</span><span class="nv">markmacro-select-last-overlay</span><span class="p">))))</span>

<span class="nv">=&gt;</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">markmacro-mark-words</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">bound</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nv">region-end</span><span class="p">))</span>
                 <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">'symbol</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">mark-bounds</span> <span class="o">'</span><span class="p">()))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">bound</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">deactivate-mark</span><span class="p">))</span>

      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">mark-bound-start</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">bound</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">mark-bound-end</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">bound</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">last-point</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nv">new-current-bound</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">save-excursion</span>
          <span class="p">(</span><span class="nv">goto-char</span> <span class="nv">mark-bound-start</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="nv">mark-bound-end</span><span class="p">)</span>
                      <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nv">point</span><span class="p">)</span> <span class="nv">last-point</span><span class="p">))</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">new-current-bound</span> <span class="p">(</span><span class="nv">bounds-of-thing-at-point</span> <span class="ss">'word</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">when</span> <span class="nv">new-current-bound</span>
              <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'mark-bounds</span> <span class="nv">new-current-bound</span> <span class="no">t</span><span class="p">))</span>
            <span class="p">(</span><span class="k">setq</span> <span class="nv">last-point</span> <span class="p">(</span><span class="nv">point</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">forward-word</span><span class="p">))))</span>

      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">bound</span> <span class="nv">mark-bounds</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">overlay</span> <span class="p">(</span><span class="nv">make-overlay</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">bound</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">bound</span><span class="p">))))</span>
          <span class="p">(</span><span class="nv">overlay-put</span> <span class="nv">overlay</span> <span class="ss">'face</span> <span class="ss">'markmacro-mark-face</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'markmacro-overlays</span> <span class="nv">overlay</span> <span class="no">t</span><span class="p">)))</span>

      <span class="p">(</span><span class="nv">markmacro-select-last-overlay</span><span class="p">))))</span>
</code></pre></div></div>

<h3 id="case-8">Case 8</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_8.gif" alt="" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">window.scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="c1">; document.getElementsByTagName('html')[0].style.visibility = 'hidden'; document.getElementsByClassName('lf_area')[0].style.visibility = 'visible'; document.getElementsByTagName('header')[0].style.display = 'none'; document.getElementsByClassName('contentPadding')[0].style.padding = '10px';</span>

<span class="nv">=&gt;</span> 

<span class="nv">window.scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="c1">;</span>
<span class="nv">document.getElementsByTagName</span><span class="p">(</span><span class="ss">'html</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.visibility</span> <span class="nb">=</span> <span class="ss">'hidden</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByClassName</span><span class="p">(</span><span class="ss">'lf_area</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.visibility</span> <span class="nb">=</span> <span class="ss">'visible</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByTagName</span><span class="p">(</span><span class="ss">'header</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.display</span> <span class="nb">=</span> <span class="ss">'none</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByClassName</span><span class="p">(</span><span class="ss">'contentPadding</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.padding</span> <span class="nb">=</span> <span class="ss">'10px</span><span class="o">'</span><span class="c1">;</span>
</code></pre></div></div>

<ul>
  <li>Move cursor to left position of <code class="language-plaintext highlighter-rouge">;</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-chars</code> to selection <strong>mark chars</strong> <code class="language-plaintext highlighter-rouge">;</code> in string</li>
  <li><code class="language-plaintext highlighter-rouge">forward-char</code> and <code class="language-plaintext highlighter-rouge">newline</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark chars</strong></p>
  </li>
  <li>Move cursor to left position of <code class="language-plaintext highlighter-rouge">(defun markmacro-mark-words</code></li>
  <li><code class="language-plaintext highlighter-rouge">mark-sexp</code> to selection region of <code class="language-plaintext highlighter-rouge">markmacro-mark-words</code> function</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-secondary-region-set</code> translate region to secondary region</li>
  <li>Move cursor to target (<code class="language-plaintext highlighter-rouge">current-bound</code> in this case), <code class="language-plaintext highlighter-rouge">markmacro-secondary-region-mark-cursors</code> mark <strong>all targets</strong> in secondary region</li>
  <li>Type something, <code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>all targets</strong></li>
</ul>

<h3 id="case-8-1">Case 8</h3>
<p><img src="./images/case8.gif" /></p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">window.scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="c1">; document.getElementsByTagName('html')[0].style.visibility = 'hidden'; document.getElementsByClassName('lf_area')[0].style.visibility = 'visible'; document.getElementsByTagName('header')[0].style.display = 'none'; document.getElementsByClassName('contentPadding')[0].style.padding = '10px';</span>

<span class="nv">=&gt;</span> 

<span class="nv">window.scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="c1">;</span>
<span class="nv">document.getElementsByTagName</span><span class="p">(</span><span class="ss">'html</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.visibility</span> <span class="nb">=</span> <span class="ss">'hidden</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByClassName</span><span class="p">(</span><span class="ss">'lf_area</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.visibility</span> <span class="nb">=</span> <span class="ss">'visible</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByTagName</span><span class="p">(</span><span class="ss">'header</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.display</span> <span class="nb">=</span> <span class="ss">'none</span><span class="o">'</span><span class="c1">;</span>
<span class="nv">document.getElementsByClassName</span><span class="p">(</span><span class="ss">'contentPadding</span><span class="o">'</span><span class="p">)</span><span class="nv">[0].style.padding</span> <span class="nb">=</span> <span class="ss">'10px</span><span class="o">'</span><span class="c1">;</span>
</code></pre></div></div>

<ul>
  <li>Move cursor to left position of <code class="language-plaintext highlighter-rouge">;</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-mark-chars</code> to selection <strong>mark chars</strong> <code class="language-plaintext highlighter-rouge">;</code> in string</li>
  <li><code class="language-plaintext highlighter-rouge">forward-char</code> and <code class="language-plaintext highlighter-rouge">newline</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to all <strong>mark chars</strong></li>
</ul>

<h3 id="case-9">Case 9</h3>
<p><img src="//manateelazycat.github.io/pics/markmacro/case_9.gif" alt="" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>find .git/objects <span class="nt">-type</span> f.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 <span class="c"># tree 2.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 # commit 3.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a # test.txt v2.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 # tree 3.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 # test.txt v1.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d # commit 2.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 # 'test content'.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 # tree 1.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 # new.txt.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d # commit 1</span>

<span class="o">=&gt;</span> 

<span class="nv">$ </span>find .git/objects <span class="nt">-type</span> f
.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 <span class="c"># tree 2</span>
.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 <span class="c"># commit 3</span>
.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a <span class="c"># test.txt v2</span>
.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 <span class="c"># tree 3</span>
.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 <span class="c"># test.txt v1</span>
.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d <span class="c"># commit 2</span>
.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 <span class="c"># 'test content'</span>
.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 <span class="c"># tree 1</span>
.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 <span class="c"># new.txt</span>
.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d <span class="c"># commit 1</span>
</code></pre></div></div>

<ul>
  <li>Move cursor to <strong>second</strong> <code class="language-plaintext highlighter-rouge">.git</code>, and select to end of string</li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-secondary-region-set</code> translate region to secondary region</li>
  <li>Select <strong>second</strong> <code class="language-plaintext highlighter-rouge">.git</code></li>
  <li><code class="language-plaintext highlighter-rouge">markmacro-secondary-region-mark-cursors</code> mark all <strong>.git</strong></li>
  <li>Press RETURN char, <code class="language-plaintext highlighter-rouge">markmacro-apply-all</code> apply kmacro to <strong>.git</strong></li>
</ul>

<h2 id="最后">最后</h2>
<p>用心体验一下， 就会发现这个插件带来的生产力非常高。 ;)</p>